{% extends "base.html" %}

{% block title %}{{ filename }} ~ Physics QA{% endblock %}

{% block content %}
<div class="app">
    <header class="header">
        <div class="header-title">
            <h1>{{ filename }}</h1>
        </div>
        <div class="header-status">
            <a href="/" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </header>

    <div class="output-view-container">
        <div class="output-view-header">
            <span class="output-view-count">{{ total }} QA pairs</span>
            <div class="view-toggle">
                <button class="toggle-btn active" data-view="readable">Readable</button>
                <button class="toggle-btn" data-view="json">JSON</button>
            </div>
        </div>

        <!-- Readable View -->
        <div class="output-view-list view-readable active">
            {% for qa in items %}
            <div class="output-qa-item">
                <div class="output-qa-header">
                    <span class="output-qa-index">#{{ qa._index + 1 }}</span>
                    <span class="output-qa-topic">{{ qa.topic if qa.topic else 'physics' }}</span>
                </div>
                <div class="output-qa-question math-content">
                    {{ qa.query | texify | safe }}
                </div>
                <details class="output-qa-details" ontoggle="if(this.open && window.MathJax) MathJax.typeset();">
                    <summary>View Answer</summary>
                    <div class="output-qa-answer">
                        <h4>Answer</h4>
                        <div class="math-content">{{ qa.response_answer | texify | safe }}</div>
                        <h4>Reasoning</h4>
                        <div class="reasoning-content math-content">{{ qa.response_reasoning }}</div>
                    </div>
                </details>
            </div>
            {% endfor %}
        </div>

        <!-- JSON View -->
        <div class="output-view-list view-json">
            {% for qa in items %}
            <div class="output-qa-item json-item">
                <div class="output-qa-header">
                    <span class="output-qa-index">#{{ qa._index + 1 }}</span>
                </div>
                <pre class="json-content">{{ qa | tojson(indent=2) }}</pre>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Toggle between views
document.querySelectorAll('.toggle-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
        var view = this.dataset.view;

        // Update toggle buttons
        document.querySelectorAll('.toggle-btn').forEach(function(b) { b.classList.remove('active'); });
        this.classList.add('active');

        // Update views
        document.querySelectorAll('.output-view-list').forEach(function(v) { v.classList.remove('active'); });
        document.querySelector('.view-' + view).classList.add('active');

        // Re-render MathJax when switching to readable view
        if (view === 'readable' && window.MathJax) {
            MathJax.typeset();
        }
    });
});

// Initial MathJax render
document.addEventListener('DOMContentLoaded', function() {
    if (window.MathJax) {
        MathJax.typeset();
    }
});
</script>
{% endblock %}
